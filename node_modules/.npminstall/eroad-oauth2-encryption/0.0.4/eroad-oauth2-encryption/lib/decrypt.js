const crypt = require('./helpers/crypt');
const md5 = require('./helpers/md5');
const sha256 = require('./helpers/sha256');

/**
 * 解密数据
 *
 * @param {Object} data 加密的数据
 *
 * @param {String} key  密匙
 * 
 * @param {String} salt 标记
 *
 * @return {Object}  解密后的数据
 */
function decrypt(data, key, salt) {
    let summary = data.summary,
        originalData = data.data,
        decryptedData;

    dencry();

    function dencry(){
            md5Date = md5.hex_md5(originalData),
            newMd5Date = md5.hex_md5(md5Date + key + salt);
        
        if(newMd5Date === summary){
            decryptedData = JSON.parse(decryOriginalData(originalData, key));      
        }
    }

    function decryOriginalData(originalData, key){
        let srck = crypt.enc.Utf8.parse(key);
        let decrypted = crypt.AES.decrypt(originalData, srck, { mode: crypt.mode.ECB, padding: crypt.pad.ZeroPadding });
        return crypt.enc.Utf8.stringify(decrypted).toString();
    }    
    
    return decryptedData;
}

module.exports = decrypt